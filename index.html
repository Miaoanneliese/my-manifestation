<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>我的生活・投資手帖</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&family=Noto+Sans+TC:wght@300;400;500&family=Material+Icons+Round&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
      :root { 
          --bg-color: #F9F9F6; --card-bg: #FFFFFF; --text-main: #4a4a4a; --text-sub: #999999; 
          --border-color: #EBEBEB; --muji-red: #8a1c1c; --muji-green: #6c8c6e; --accent-brown: #8D8170; 
          --tag-bg: #E6E4E0; --btn-green: #597e5d; --table-header-bg: #f4f4f0; 
      }
      * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
      body { margin: 0; font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); color: var(--text-main); padding-bottom: 80px; letter-spacing: 0.03em; overscroll-behavior-y: none; user-select: none; -webkit-user-select: none; }
      input, textarea { user-select: text; -webkit-user-select: text; }
      header { background-color: var(--bg-color); padding: 25px 20px 10px; }
      .date-weather-box { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid var(--text-main); padding-bottom: 10px; }
      .current-date { font-family: 'Noto Serif TC', serif; font-size: 1.5rem; font-weight: 900; color: #333; }
      .day-tag { font-size: 0.9rem; margin-left: 5px; color: var(--text-sub); }
      .weather-info { display: flex; align-items: center; font-size: 0.9rem; color: var(--text-sub); gap: 5px; }
      main { padding: 20px; }
      .muji-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 3px; padding: 15px 20px; margin-bottom: 15px; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.02); display: flex; flex-direction: column; }
      .card-label { font-size: 0.7rem; color: var(--text-sub); margin-bottom: 10px; letter-spacing: 1.5px; font-weight: 500; text-transform: uppercase; }
      .muji-title { font-family: 'Noto Serif TC', serif; font-size: 1.4rem; margin: 10px 0 20px; text-align: center; color: var(--muji-red); }
      .big-number { font-size: 1.6rem; font-weight: 300; font-family: 'Noto Serif TC', serif; color: #333; }
      .dashboard-grid { display: flex; gap: 10px; margin-bottom: 15px; align-items: stretch; }
      .schedule-card { flex: 3; margin-bottom: 0; min-width: 0; }
      .right-col { flex: 2; display: flex; flex-direction: column; gap: 10px; min-width: 0; }
      .goal-card, .quote-card { flex: 1; margin-bottom: 0; }
      .goal-text-read { font-family: 'Noto Serif TC', serif; color: var(--text-main); font-size: 0.95rem; line-height: 1.6; white-space: pre-wrap; flex: 1; overflow-y: auto; scrollbar-width: thin; max-height: 100px; }
      .quote-text { font-family: 'Noto Serif TC', serif; font-size: 0.85rem; line-height: 1.6; color: var(--accent-brown); flex: 1; display: flex; align-items: center; }
      .dashboard-main-grid { display: grid; grid-template-columns: 1fr 55px 1fr 55px; gap: 10px; align-items: stretch; }
      .dashboard-main-grid > * { min-width: 0; } 
      .dashboard-main-grid .muji-card, .dashboard-main-grid .action-btn-container { margin-bottom: 0; height: 100%; }
      .grid-left-block { grid-column: 1 / 3; } .grid-right-block { grid-column: 3 / 5; } .grid-full-width { grid-column: 1 / 5; }
      .grid-c1 { grid-column: 1; } .grid-c2 { grid-column: 2; } .grid-c3 { grid-column: 3; } .grid-c4 { grid-column: 4; }
      .left-stack-wrapper { display: flex; flex-direction: column; gap: 10px; height: 100%; }
      .left-stack-wrapper .muji-card:last-child { flex: 1; }
      .expense-display { display: flex; flex-direction: column; justify-content: center; min-width: 0; }
      .action-btn-container { width: 55px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); text-decoration: none; background: #fff; border: 1px solid var(--border-color); transition: all 0.2s; }
      .action-btn-container:active { transform: scale(0.95); background: #f5f5f5; }
      .record-btn { background: var(--muji-red); color: white; border-color: var(--muji-red); }
      .link-btn { background: var(--btn-green); color: white; border-color: var(--btn-green); }
      .btn-icon span { font-size: 26px; margin-bottom: 2px; }
      .btn-text { font-size: 0.75rem; letter-spacing: 1px; writing-mode: vertical-rl; text-orientation: upright; }
      .gratitude-compact { display: flex; flex-direction: row; gap: 8px; align-items: center; margin-top: auto; padding-top: 8px; border-top: 1px solid #f0f0f0; }
      .input-underline { flex: 1; border: none; border-bottom: 1px solid #ddd; background: transparent; padding: 4px 0; font-size: 0.9rem; border-radius: 0; outline: none; transition: border-color 0.3s; }
      .input-underline:focus { border-bottom-color: var(--accent-brown); }
      .btn-mini-muji { padding: 6px 14px; background: #fff; border: 1px solid #d0d0d0; color: #777; font-size: 0.8rem; border-radius: 2px; cursor: pointer; transition: all 0.3s ease; white-space: nowrap; font-weight: 500; letter-spacing: 1px; }
      .btn-mini-muji:active, .btn-mini-muji:hover { background: #fafafa; border-color: var(--accent-brown); color: var(--accent-brown); }
      #mini-gratitude-list { list-style: none; padding: 0; margin: 0 0 8px 0; display: flex; flex-direction: column; overflow: hidden; }
      #mini-gratitude-list li { font-size: 0.85rem; color: #666; padding: 4px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.6; display: flex; align-items: center; }
      #mini-gratitude-list li .date { color: var(--accent-brown); font-size: 0.75rem; margin-right: 8px; font-family: 'Noto Sans TC', sans-serif; min-width: 40px; letter-spacing: 0.5px; font-weight: 500; }
      .calendar-list, .journal-list { list-style: none; padding: 0; margin: 0; flex: 1; }
      .calendar-list li { padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; width: 100%; overflow: hidden; }
      .cal-date { margin-right: 5px; font-weight: 600; color: var(--accent-brown); flex-shrink: 0; margin-top: 2px; }
      .cal-title-wrapper { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block; color: #555; cursor: pointer; transition: color 0.2s; }
      .cal-title-wrapper:active { color: #000; }
      .cal-title-wrapper.expanded { white-space: normal; overflow: visible; word-break: break-all; }
      .table-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; border: 1px solid #ddd; border-radius: 4px; }
      .table-wrapper.scrollable { max-height: 300px; } .table-wrapper.auto-height { max-height: none; overflow-y: visible; height: 100%; }
      .muji-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; white-space: nowrap; }
      .muji-table td, .muji-table th { padding: 10px 12px; border: 1px solid #eee; color: var(--text-main); text-align: left; vertical-align: middle; }
      .muji-table th { color: #888; font-weight: normal; position: sticky; top: 0; background: #fff; z-index: 10; border-bottom: 2px solid #ccc; }
      #table-invest-calc tr:first-child th { background-color: var(--table-header-bg); color: var(--accent-brown); font-family: 'Noto Serif TC', serif; font-weight: 600; }
      #table-invest-calc td:first-child, #table-invest-calc th:first-child { position: sticky; left: 0; background: #fafafa; z-index: 20; border-right: 2px solid #eee; width: 80px; min-width: 80px; text-align: center; }
      #table-invest-calc th:first-child { z-index: 30; background: var(--table-header-bg); }
      #table-profit { table-layout: fixed; width: 100%; }
      #table-profit tr:nth-child(1) td, #table-profit tr:nth-child(2) td { background-color: var(--table-header-bg); color: var(--accent-brown); font-weight: 600; text-align: center; }
      #table-profit td:first-child { background-color: #fafafa; font-weight: 600; color: var(--accent-brown); border-right: 2px solid #eee; position: sticky; left: 0; z-index: 20; width: 85px; min-width: 85px; max-width: 85px; text-align: left; white-space: normal; }
      #table-profit td:not(:first-child) { text-align: center; width: auto; padding: 5px 2px; }
      .text-right { text-align: right; font-family: monospace; letter-spacing: 0.5px; }
      .text-pos { color: var(--muji-red) !important; font-weight: bold; } .text-neg { color: var(--muji-green) !important; font-weight: bold; } 
      .journal-list li { padding: 12px 0; border-bottom: 1px dashed #eee; font-size: 0.9rem; line-height: 1.6; color: var(--text-main); }
      .journal-list li:last-child { border-bottom: none; }
      .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
      .modal-overlay.active { display: flex; animation: fadeIn 0.2s; }
      .modal-content { background: white; width: 90%; max-width: 500px; padding: 25px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-height: 90vh; overflow-y: auto; }
      .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
      .modal-header h3 { margin: 0; font-family: 'Noto Serif TC', serif; font-weight: 600; color: #333; }
      .close-btn { cursor: pointer; color: #999; font-size: 24px; }
      input[type="text"], input[type="number"], input[type="date"], select, textarea { width: 100%; padding: 12px; font-size: 0.95rem; color: #333; border: 1px solid #ddd; border-radius: 2px; background-color: #fafafa; outline: none; box-sizing: border-box; transition: border-color 0.2s; }
      input:focus, textarea:focus, select:focus { border-color: #999; background: #fff; }
      .input-group { margin-bottom: 15px; }
      label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 4px; }
      .flex-row { display: flex; gap: 8px; } .flex-col { flex: 1; }
      .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
      .switch input { opacity: 0; width: 0; height: 0; }
      .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 22px; }
      .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
      input:checked + .slider { background-color: #555; }
      input:checked + .slider:before { transform: translateX(18px); }
      .chip-group { display: flex; gap: 8px; flex-wrap: wrap; }
      .muji-chip input { display: none; }
      .muji-chip span { display: inline-block; padding: 6px 12px; border: 1px solid var(--border-color); color: var(--text-sub); font-size: 0.85rem; cursor: pointer; border-radius: 2px; }
      .muji-chip input:checked + span { background: var(--text-main); color: white; border-color: var(--text-main); }
      .btn-muji { width: 100%; padding: 15px; background: #333; color: white; border: none; font-size: 1rem; cursor: pointer; margin-top: 15px; border-radius: 2px; letter-spacing: 1px; transition: background 0.2s; }
      .btn-muji:active { background-color: #000; }
      .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid var(--border-color); display: grid; grid-template-columns: 1fr 1fr 1fr; height: 56px; align-items: center; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
      .nav-btn { background: none; border: none; color: #bbb; height: 100%; padding: 0; cursor: pointer; display: flex; justify-content: center; align-items: center; }
      .nav-btn.active { color: #444; }
      .nav-btn .material-icons-round { font-size: 28px; }
      .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.3s; }
      .mode-select-container { display: flex; flex-direction: column; gap: 10px; padding: 20px; justify-content: center; height: 50vh; }
      .mode-btn { padding: 15px; font-size: 1rem; border: 1px solid #ddd; background: #fff; border-radius: 4px; color: #555; text-align: center; cursor: pointer; display: flex; flex-direction: row; justify-content: center; align-items: center; gap: 10px; }
      .operation-container { padding-bottom: 70px; max-width: 600px; margin: 0 auto; }
      .hidden { display: none !important; }
      .mini-select { font-size: 0.85rem; padding: 5px; height: 32px; }
      .tech-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
      .journal-section-btn { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 15px; margin-top: 15px; background: #fff; border: 1px solid #ddd; border-radius: 4px; text-align: left; color: #555; font-size: 1rem; cursor: pointer; }
      #toast { position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); background: var(--text-main); color: #fff; padding: 10px 20px; border-radius: 20px; font-size: 0.9rem; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 3000; white-space: nowrap; }
      @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
      .goal-header-group { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px 8px; border-bottom: 1px solid #f0f0f0; }
      .cycle-badge { background-color: var(--muji-red); color: white; font-size: 0.75rem; padding: 2px 10px; border-radius: 12px; font-weight: 500; letter-spacing: 0.5px; }
      .macro-goal-container { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; background-color: #fff; }
      .macro-row { display: flex; align-items: baseline; margin-bottom: 10px; width: 100%; }
      .macro-row:last-child { margin-bottom: 0; }
      .macro-label { font-size: 0.7rem; color: #555; background-color: var(--tag-bg); padding: 2px 6px; border-radius: 2px; margin-right: 8px; flex-shrink: 0; font-weight: 500; }
      .macro-text { font-size: 0.85rem; color: var(--text-main); line-height: 1.4; letter-spacing: 0.5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; transition: color 0.2s; }
      .macro-text.expanded { white-space: normal; overflow: visible; word-break: break-all; }
      .cycle-list-container { flex: 1; overflow-y: auto; padding: 8px 15px 12px; }
      .cycle-list-item { padding: 8px 0; border-bottom: 1px dashed #eee; display: flex; align-items: flex-start; }
      .cycle-cat { color: var(--muji-red); font-weight: 600; margin-right: 8px; white-space: nowrap; font-size: 0.8rem; margin-top: 1px; min-width: 32px; }
      .cycle-desc { color: #555; font-size: 0.85rem; line-height: 1.5; }
    </style>
</head>
<body>
    <header>
      <div class="date-weather-box">
        <div class="current-date"><span id="header-date">...</span> <span id="header-day" class="day-tag">...</span></div>
        <div class="weather-info" id="weather-display"><span class="material-icons-round">wb_sunny</span> <span>讀取中...</span></div>
      </div>
    </header>
    <main id="app">
      <div id="tab-operation" class="tab-content">
        <div class="muji-title">操作紀錄</div>
        <div id="op-selection" class="mode-select-container">
          <div class="mode-btn" onclick="selectMode('swing')"><span class="material-icons-round">trending_up</span> 波段操作</div>
          <div class="mode-btn" onclick="selectMode('daytrade')"><span class="material-icons-round">flash_on</span> 當沖交易</div>
        </div>
        <div id="form-swing" class="operation-container hidden">
          <div class="muji-card">
            <div style="display:flex; align-items:center; margin-bottom:15px; color:#888; font-size:0.9rem; cursor:pointer;" onclick="backToSelection()">
               <span class="material-icons-round" style="font-size:18px; margin-right:4px;">arrow_back</span> 返回
            </div>
            <form id="stockForm">
              <div class="input-group"><label>日期</label><input type="date" id="s_date" required></div>
              <div class="flex-row"><div class="flex-col input-group"><label>代號</label><input type="text" id="s_code" placeholder="2330" required inputmode="numeric"></div><div class="flex-col input-group"><label>名稱</label><input type="text" id="s_name" placeholder="台積電" required></div></div>
              <div class="flex-row"><div class="flex-col input-group"><label>股數</label><input type="number" id="s_shares" placeholder="1000" inputmode="numeric"></div><div class="flex-col input-group"><label>價格</label><input type="number" id="s_price" step="0.01" inputmode="decimal"></div></div>
              <div class="input-group"><label>交割價</label><input type="number" id="s_settlement" step="1" inputmode="decimal"></div>
              <div class="flex-row"><div class="flex-col input-group"><label>趨勢</label><select id="s_trend"><option value="多">多</option><option value="空">空</option></select></div><div class="flex-col input-group"><label>動作</label><select id="s_action" onchange="updateReasonOptions()" style="background-color: #fffef0;"><option value="進場">進場</option><option value="出場">出場</option></select></div></div>
              <div class="input-group"><label id="reasonLabel" style="color: #d35400;">進場條件</label><select id="s_reason" style="border-color: #e6b0aa;"></select></div>
              <details><summary>技術分析 (選填)</summary><div class="tech-grid"><div class="tech-item"><label>周趨勢</label><select id="s_weekTrend" class="mini-select"><option></option><option>多</option><option>空</option><option>盤整</option></select></div><div class="tech-item"><label>日趨勢</label><select id="s_dayTrend" class="mini-select"><option></option><option>多</option><option>空</option><option>盤整</option></select></div><div class="tech-item"><label>位置</label><select id="s_position" class="mini-select"><option></option><option>起漲</option><option>走勢高檔</option><option>趨勢高檔</option><option>頭部</option><option>行進間</option><option>起跌</option><option>走勢低檔</option><option>趨勢低檔</option><option>底部</option></select></div><div class="tech-item"><label>成交量</label><select id="s_volume" class="mini-select"><option></option><option>價↑量↑</option><option>價↑量-</option><option>價↑量↓</option><option>價↓量↑</option><option>價↓量-</option><option>價↓量↓</option></select></div><div class="tech-item"><label>20T</label><select id="s_ma20t" class="mini-select"><option></option><option>↑20↑</option><option>↑20↓</option><option>-20-</option><option>↓20↑</option><option>↓20↓</option></select></div><div class="tech-item"><label>均線</label><select id="s_maArrangement" class="mini-select"><option></option><option>3線多排</option><option>4線多排</option><option>3線空排</option><option>4線空排</option></select></div><div class="tech-item"><label>KD</label><select id="s_kd" class="mini-select"><option></option><option>80以上</option><option>黃金交叉</option><option>多↑</option><option>多↓</option><option>死亡交叉</option><option>空↑</option><option>空↓</option><option>20以下</option></select></div><div class="tech-item"><label>MACD</label><select id="s_macd" class="mini-select"><option></option><option>紅↑</option><option>紅↓</option><option>綠↑</option><option>綠↓</option></select></div></div><div class="tech-item" style="margin-top:8px;"><label>壓力</label><select id="s_pressure" class="mini-select"><option></option><option>波浪型態的高點(頭)</option><option>密集盤整區</option><option>盤整區的上/下頸線</option><option>上升/下降切線</option><option>移動平均線(均線)</option><option>跳空缺口</option><option>大量成交的紅黑K棒</option><option>心理預期</option></select></div><div class="tech-item" style="margin-top:8px;"><label>支撐</label><select id="s_support" class="mini-select"><option></option><option>波浪型態的低點(底)</option><option>密集盤整區</option><option>盤整區的上/下頸線</option><option>上升/下降切線</option><option>移動平均線(均線)</option><option>跳空缺口</option><option>大量成交的紅黑K棒</option><option>心理預期</option></select></div></details>
              <button type="button" class="btn-muji" onclick="submitStock()">送出紀錄</button>
            </form>
          </div>
        </div>
        <div id="form-daytrade" class="operation-container hidden">
          <div class="muji-card">
            <div style="display:flex; align-items:center; margin-bottom:15px; color:#888; font-size:0.9rem; cursor:pointer;" onclick="backToSelection()">
               <span class="material-icons-round" style="font-size:18px; margin-right:4px;">arrow_back</span> 返回
            </div>
            <form id="dayTradeForm">
              <div class="input-group"><label>日期</label><input type="date" id="d_date" required></div>
              <div class="flex-row"><div class="flex-col input-group"><label>代號</label><input type="text" id="d_code" placeholder="2330" required inputmode="numeric"></div><div class="flex-col input-group"><label>名稱</label><input type="text" id="d_name" placeholder="台積電" required></div></div>
              <div class="input-group"><label>操作趨勢</label><select id="d_trend" onchange="updateDayTradeReason()" style="background-color: #fffef0;"><option value="多">多</option><option value="空">空</option></select></div>
              <div class="input-group"><label>鎖定原因</label><select id="d_reason" style="border-color: #e6b0aa;"></select></div>
              <details open><summary>進場觀察</summary><div class="tech-grid"><div class="tech-item"><label>前日20T</label><select id="d_prev20t" class="mini-select"><option></option><option>↑20T↑</option><option>↑20T↓</option><option>↓20T↓</option><option>↓20T↑</option></select></div><div class="tech-item"><label>前日量</label><select id="d_prevVol" class="mini-select"><option></option><option>↑</option><option>↓</option></select></div><div class="tech-item"><label>前日KD</label><select id="d_prevKd" class="mini-select"><option></option><option>黃金交叉</option><option>多↑</option><option>多↓</option><option>死亡交叉</option><option>空↑</option><option>空↓</option></select></div><div class="tech-item"><label>日趨勢</label><select id="d_dayTrend" class="mini-select"><option></option><option>多</option><option>空</option><option>盤整</option></select></div><div class="tech-item"><label>15分趨勢</label><select id="d_trend15m" class="mini-select"><option></option><option>多</option><option>空</option><option>盤整</option></select></div><div class="tech-item"><label>5分趨勢</label><select id="d_trend5m" class="mini-select"><option></option><option>多</option><option>空</option><option>盤整</option></select></div></div></details>
              <div class="input-group" style="margin-top:10px;"><label>股數</label><input type="number" id="d_shares" placeholder="1000" inputmode="numeric"></div>
              <div class="flex-row"><div class="flex-col input-group"><label>進場價</label><input type="number" id="d_entryPrice" step="0.01" inputmode="decimal"></div><div class="flex-col input-group"><label>實際進</label><input type="number" id="d_realEntryPrice" step="0.01" inputmode="decimal"></div></div>
              <div class="flex-row"><div class="flex-col input-group"><label>出場價</label><input type="number" id="d_exitPrice" step="0.01" inputmode="decimal"></div><div class="flex-col input-group"><label>實際出</label><input type="number" id="d_realExitPrice" step="0.01" inputmode="decimal"></div></div>
              <div class="input-group"><label>出場原因</label><select id="d_exitReason"><option>停利</option><option>停損</option><option>鎖股觀察</option><option>遇壓</option><option>遇撐</option></select></div>
              <button type="button" class="btn-muji" onclick="submitDayTrade()">送出當沖紀錄</button>
            </form>
          </div>
        </div>
      </div>
      <div id="tab-dashboard" class="tab-content active">
        <div class="dashboard-grid">
            <div class="muji-card schedule-card">
                <div class="card-label">本週行程</div>
                <ul class="calendar-list" id="calendar-list"><li>讀取中...</li></ul>
            </div>
            <div class="right-col">
                <div class="muji-card goal-card">
                    <div class="card-label">今日目標</div>
                    <div id="goal-display" class="goal-text-read">讀取中...</div>
                </div>
                <div class="muji-card quote-card">
                    <div class="card-label">每日一句</div>
                    <div class="quote-text" id="daily-quote">讀取中...</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-main-grid">
            <div class="muji-card expense-display grid-c1" onclick="triggerManualSync()">
                <div class="card-label">今日開銷</div>
                <div class="big-number" id="today-expense">...</div>
            </div>
            <div class="action-btn-container record-btn grid-c2" onclick="openModal()">
                <div class="btn-icon"><span class="material-icons-round">edit_note</span></div>
                <div class="btn-text">記帳</div>
            </div>
            <div class="muji-card expense-display grid-c3">
                <div class="card-label">本月支出</div>
                <div class="big-number" id="month-expense" style="color: var(--text-main);">...</div>
            </div>
            <a href="https://docs.google.com/spreadsheets/d/1vRIp7aP_Fz8fCClQ8PzQs-412KsM_uvyY3WsEqUedxg/edit#gid=1703556943" target="sheet_view" class="action-btn-container link-btn grid-c4">
                <div class="btn-icon"><span class="material-icons-round">table_view</span></div>
                <div class="btn-text">表格</div>
            </a>

            <div class="left-stack-wrapper grid-left-block">
                <div class="muji-card" style="padding: 12px 15px; flex: 0 0 auto; height: auto;">
                    <div class="card-label" style="margin-bottom: 2px;">感恩事件</div>
                    <ul id="mini-gratitude-list"><li>讀取中...</li></ul>
                    <div class="gratitude-compact">
                        <input type="text" id="journal-text" class="input-underline" placeholder="隨手記錄...">
                        <button type="button" class="btn-mini-muji" onclick="submitGratitude()">感謝</button>
                    </div>
                </div>
                
                <div class="muji-card" style="display: flex; flex-direction: column; min-height: 0; overflow: hidden; padding: 0;">
                    <div class="goal-header-group">
                         <div class="card-label" style="margin:0;">目標實踐</div>
                         <div style="display:flex; align-items:center;">
                             <div class="cycle-badge" id="cycle-id">Cycle ...</div>
                             <span id="cycle-rate" class="cycle-badge" style="background:var(--accent-brown); margin-left:5px;">0%</span>
                         </div>
                    </div>
                    <div class="macro-goal-container">
                        <div class="macro-row" style="display: flex; gap: 10px;">
                            <div style="flex: 1; display: flex; align-items: baseline; min-width: 0;">
                                <span class="macro-label">年</span>
                                <span id="goal-year" class="macro-text" onclick="toggleText(this)">...</span>
                            </div>
                            <div style="flex: 1; display: flex; align-items: baseline; min-width: 0;">
                                <span class="macro-label">季</span>
                                <span id="goal-season" class="macro-text" onclick="toggleText(this)">...</span>
                            </div>
                        </div>
                        <div class="macro-row" style="margin-top: 8px;">
                            <span class="macro-label">周</span>
                            <span id="cycle-range-display" class="date-suffix" style="margin-right: 8px; color: #999; font-size: 0.75rem; font-weight: 500;"></span>
                            <span id="goal-weekly" class="macro-text" onclick="toggleText(this)">...</span>
                        </div>
                    </div>
                    <div class="cycle-list-container">
                        <div class="cycle-list-item"><span class="cycle-cat">職業</span> <span id="goal-career" class="cycle-desc">...</span></div>
                        <div class="cycle-list-item"><span class="cycle-cat">健康</span> <span id="goal-health" class="cycle-desc">...</span></div>
                        <div class="cycle-list-item"><span class="cycle-cat">財務</span> <span id="goal-wealth" class="cycle-desc">...</span></div>
                        <div class="cycle-list-item"><span class="cycle-cat">技能</span> <span id="goal-skills" class="cycle-desc">...</span></div>
                        <div class="cycle-list-item"><span class="cycle-cat">生活</span> <span id="goal-life" class="cycle-desc">...</span></div>
                    </div>
                </div>
            </div>
            <div class="muji-card grid-right-block">
                <div class="card-label">損益試算表</div>
                <div class="table-wrapper auto-height"><table id="table-profit" class="muji-table"></table></div>
            </div>
            <div class="muji-card grid-full-width">
                <div class="card-label">顯化冥想</div>
                <ul class="journal-list" id="list-manifestation"><li style="color:#ccc; text-align:center;">讀取中...</li></ul>
            </div>
            <div class="muji-card grid-full-width">
                <div class="card-label">投資計算表</div>
                <div class="table-wrapper scrollable"><table id="table-invest-calc" class="muji-table"></table></div>
            </div>
        </div>
      </div>
      <div id="tab-journal" class="tab-content">
        <div class="muji-title">顯化日記</div>
        <div class="operation-container">
          <div style="padding: 0 10px;">
            <button class="journal-section-btn" onclick="openJournalModal('start')"><span>一日之始</span> <span class="material-icons-round">chevron_right</span></button>
            <button class="journal-section-btn" onclick="openJournalModal('middle')"><span>一日之中</span> <span class="material-icons-round">chevron_right</span></button>
            <button class="journal-section-btn" onclick="openJournalModal('end')"><span>一日之末</span> <span class="material-icons-round">chevron_right</span></button>
          </div>
        </div>
      </div>
    </main>
    <nav class="bottom-nav">
      <button onclick="switchTab('tab-operation')" class="nav-btn" id="nav-operation"><span class="material-icons-round">trending_up</span></button>
      <button onclick="switchTab('tab-dashboard')" class="nav-btn active" id="nav-dashboard"><span class="material-icons-round">home</span></button>
      <button onclick="switchTab('tab-journal')" class="nav-btn" id="nav-journal"><span class="material-icons-round">auto_stories</span></button>
    </nav>
    <div id="expense-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>新增收支</h3><span class="material-icons-round close-btn" onclick="closeModal()">close</span></div><form id="modal-form"><div class="input-group"><label>金額</label><input type="number" id="amount" required placeholder="0" inputmode="decimal" style="font-size: 1.5rem; text-align: center;"></div><div class="input-group"><label>消費方式</label><div class="chip-group"><label class="muji-chip"><input type="radio" name="paymentMethod" value="現金" checked><span>現金</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="悠遊卡"><span>悠遊卡</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="台新Gogoro"><span>台新Gogoro</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="富邦J卡"><span>富邦J卡</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="中信卡"><span>中信卡</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="玉山卡"><span>玉山卡</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="新光卡"><span>新光卡</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="兆豐卡"><span>兆豐卡</span></label><label class="muji-chip"><input type="radio" name="paymentMethod" value="串暫欠"><span>串暫欠</span></label></div></div><div class="input-group" style="display:flex; justify-content:space-between; align-items:center;"><label style="margin:0;">消費拆分?</label><label class="switch"><input type="checkbox" id="isSplit" onchange="toggleSplitOptions()"><span class="slider round"></span></label></div><div id="split-section" style="display:none; background:#fafafa; padding:10px; border:1px solid #eee; margin-bottom:15px;"><div class="input-group"><label>拆分方式</label><select id="splitMethod" onchange="toggleSplitInputs()"><option value="一人一半">一人一半</option><option value="潘全額">潘全額</option><option value="潘部分">潘部分</option><option value="他人">他人</option></select></div><div id="input-pan-part" class="input-group" style="display:none;"><label>潘 部份金額</label><input type="number" id="panAmount"></div><div id="input-others" class="input-group" style="display:none;"><label>他人 金額</label><input type="number" id="othersAmount"></div><div id="input-chuan-pay" class="input-group" style="display:none;"><label>串 支付 (選填)</label><input type="number" id="chuanPay" placeholder="0"></div></div><div class="input-group" style="display:flex; align-items:center; gap:10px;"><input type="checkbox" id="isTobacco" style="width:auto;"><label for="isTobacco" style="margin:0;">是否含菸</label></div><div class="input-group"><label>備註</label><input type="text" id="note"></div><button type="button" class="btn-muji" onclick="submitModalExpense()">確認儲存</button></form></div></div>
    <div id="modal-start" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>一日之始</h3><span class="material-icons-round close-btn" onclick="closeJournalModal('start')">close</span></div><form onsubmit="submitJournalPart('start'); return false;"><div class="input-group"><label>日期</label><input type="date" id="j_date_start" required></div><div class="input-group"><label>今日目標</label><input type="text" id="j_q3"></div><div class="input-group"><label>是否能靜心看盤</label><select id="j_q4"><option value="是">是</option><option value="否">否</option></select></div><button type="submit" class="btn-muji">儲存</button></form></div></div>
    <div id="modal-middle" class="modal-overlay"><div class="modal-content" style="max-height:85vh; overflow-y:auto;"><div class="modal-header"><h3>一日之中</h3><span class="material-icons-round close-btn" onclick="closeJournalModal('middle')">close</span></div><form onsubmit="submitJournalPart('middle'); return false;"><div class="input-group"><label>日期</label><input type="date" id="j_date_middle" required></div><div class="input-group"><label>是否進行交易</label><select id="j_q5"><option value="否">否</option><option value="買進">買進</option><option value="賣出">賣出</option><option value="當沖">當沖</option></select></div><hr style="border:0; border-top:1px dashed #eee; margin:15px 0;"><h4 style="margin:0 0 10px; color:#666;">帳戶紀錄</h4><div class="flex-row"><div class="flex-col input-group"><label>帳面金額</label><input type="number" id="j_q6"></div><div class="flex-col input-group"><label>成本</label><input type="number" id="j_q7"></div></div><div class="flex-row"><div class="flex-col input-group"><label>淨值</label><input type="number" id="j_q6_net" disabled style="background:#eee;"></div></div><hr style="border:0; border-top:1px dashed #eee; margin:15px 0;"><h4 style="margin:0 0 10px; color:#666;">檢討</h4><div class="input-group"><label>檢討 (人|事|焦點)</label><textarea id="j_career_review" rows="3" placeholder="【人】... 【事】..."></textarea></div><button type="submit" class="btn-muji">儲存</button></form></div></div>
    <div id="modal-end" class="modal-overlay"><div class="modal-content" style="max-height:85vh; overflow-y:auto;"><div class="modal-header"><h3>一日之末</h3><span class="material-icons-round close-btn" onclick="closeJournalModal('end')">close</span></div><form onsubmit="submitJournalPart('end'); return false;"><div class="input-group"><label>日期</label><input type="date" id="j_date_end" required onchange="refreshMissionContext(this.value)"></div><div class="input-group" style="display:flex; justify-content:space-between; align-items:center;"><label>是否為錄影日</label><label class="switch"><input type="checkbox" id="j_is_recording"><span class="slider round"></span></label></div><div class="input-group"><label>每日習慣</label><div class="chip-group"><label class="muji-chip"><input type="checkbox" id="j_q86"> <span id="lbl_habit_1">習慣1</span></label><label class="muji-chip"><input type="checkbox" id="j_q87"> <span id="lbl_habit_2">習慣2</span></label><label class="muji-chip"><input type="checkbox" id="j_q88"> <span id="lbl_habit_3">習慣3</span></label><label class="muji-chip"><input type="checkbox" id="j_q90"> <span id="lbl_habit_4">習慣4</span></label></div></div><div class="input-group"><label>健康狀態 (運動|保養)</label><input type="text" id="j_health_status" placeholder="運動: ... | 保養: ..."></div><div class="input-group"><label>斷捨離物品</label><input type="text" id="j_declutter_item" placeholder="物品名稱 (處理方式)"></div><div class="input-group"><label>今日感受 (事件|感受)</label><textarea id="j_note" rows="2" placeholder="事件... | 感受..."></textarea></div><div class="input-group"><label>顯化 (感謝|之前|感覺)</label><textarea id="j_manifestation" rows="2" placeholder="感謝... | ...之前 | 我感覺..."></textarea></div><div class="input-group"><label>今日評分 (0-100)</label><input type="number" id="j_score" max="100"></div><button type="submit" class="btn-muji">儲存</button></form></div></div>
    <div id="toast"></div>

    <script>
        var FIREBASE_URL = "https://manifestation-fc95b-default-rtdb.asia-southeast1.firebasedatabase.app/"; 
        var FIREBASE_SECRET = "k6qAKfvcw2eqPcluPZO5JUyIcwLp6j31AM8jYNWo"; 
        var missionData = null;

        window.onload = function() {
            var today = new Date();
            var dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            document.getElementById('header-date').innerText = (today.getMonth()+1) + "." + today.getDate();
            document.getElementById('header-day').innerText = dayNames[today.getDay()];
            initDateInputs();
            loadDashboard();
            updateReasonOptions();
        };

        function getLocalISOString() {
            const d = new Date();
            const offset = d.getTimezoneOffset() * 60000;
            return new Date(d.getTime() - offset).toISOString().split('T')[0];
        }

        function initDateInputs() {
            var todayStr = getLocalISOString();
            document.querySelectorAll('input[type="date"]').forEach(el => el.value = todayStr);
        }

        function loadDashboard() {
            google.script.run.withSuccessHandler(renderDashboard).doGet({action: 'getMission'});
        }

        function refreshMissionContext(dateStr) {
            showToast("正在載入該日期的目標...");
            google.script.run.withSuccessHandler(function(data){
                missionData = data;
                updateHabitLabels(data.habit_names);
                showToast("已更新為 " + dateStr + " 的目標");
            }).doGet({action: 'getMission', date: dateStr});
        }

        function renderDashboard(data) {
            missionData = data;
            document.getElementById('weather-display').innerHTML = '<span class="material-icons-round">cloud</span> <span>Taipei</span>'; 
            
            // Goals
            document.getElementById('goal-year').innerText = data.year_goal || "未設定";
            document.getElementById('goal-season').innerText = data.season_goal || "未設定";
            document.getElementById('goal-weekly').innerText = data.cycle_goal || "未設定";
            document.getElementById('cycle-range-display').innerText = data.cycle_range || "";
            document.getElementById('cycle-id').innerText = "Cycle " + (data.cycle_id || "?");
            document.getElementById('cycle-rate').innerText = data.completion_rate;
            
            document.getElementById('goal-career').innerText = data.career;
            document.getElementById('goal-health').innerText = data.health;
            document.getElementById('goal-wealth').innerText = data.wealth;
            document.getElementById('goal-skills').innerText = data.skills;
            document.getElementById('goal-life').innerText = data.life;

            document.getElementById('goal-display').innerText = data.goalText || "今日未設定目標";
            document.getElementById('daily-quote').innerText = data.quote;
            document.getElementById('today-expense').innerText = data.todayExpense.toLocaleString();
            document.getElementById('month-expense').innerText = data.monthExpense.toLocaleString();

            updateHabitLabels(data.habit_names);
            renderLists(data);
            renderTables(data);
        }

        function updateHabitLabels(names) {
            if(names && names.length >= 4) {
                document.getElementById('lbl_habit_1').innerText = names[0];
                document.getElementById('lbl_habit_2').innerText = names[1];
                document.getElementById('lbl_habit_3').innerText = names[2];
                document.getElementById('lbl_habit_4').innerText = names[3];
            }
        }

        function renderLists(data) {
            // Calendar
            var cList = document.getElementById('calendar-list');
            cList.innerHTML = "";
            if (data.calendarEvents && data.calendarEvents.length > 0) {
                data.calendarEvents.forEach(evt => {
                    var li = document.createElement('li');
                    li.innerHTML = `<span class="cal-date">${evt.date}</span><span class="cal-title-wrapper" style="color:${evt.color}" onclick="this.classList.toggle('expanded')">${evt.title}</span>`;
                    cList.appendChild(li);
                });
            } else { cList.innerHTML = "<li style='color:#ccc; justify-content:center;'>無行程</li>"; }

            // Gratitude Widget
            var gList = document.getElementById('mini-gratitude-list');
            gList.innerHTML = "";
            if (data.gratitudeList && data.gratitudeList.length > 0) {
                data.gratitudeList.forEach(item => {
                    var li = document.createElement('li');
                    li.innerHTML = `<span class="date">${item.date.split('/')[1]}/${item.date.split('/')[2]}</span><span>${item.content}</span>`;
                    gList.appendChild(li);
                });
            } else { gList.innerHTML = "<li>無紀錄</li>"; }
            
            // Manifestation
            var mList = document.getElementById('list-manifestation');
            mList.innerHTML = "";
            if (data.manifestationList && data.manifestationList.length > 0) {
                data.manifestationList.forEach(item => {
                   var li = document.createElement('li');
                   li.innerHTML = `<div class="journal-meta">${item.date}</div><div style="margin-top:2px;">${item.content}</div>`;
                   mList.appendChild(li);
                });
            } else { mList.innerHTML = "<li style='color:#ccc; text-align:center;'>尚無顯化紀錄</li>"; }
        }

        function renderTables(data) {
            // Profit Table
            var pTable = document.getElementById('table-profit');
            pTable.innerHTML = "";
            if (data.profitData && data.profitData.length > 0) {
                data.profitData.forEach((row, rIdx) => {
                    var tr = document.createElement('tr');
                    row.forEach((cell, cIdx) => {
                        var td = document.createElement(rIdx < 2 ? 'td' : 'td'); 
                        td.innerText = cell;
                        if (cIdx > 0 && rIdx > 1) {
                            td.className = "text-right";
                            if (cell.indexOf('-') > -1) td.classList.add('text-neg');
                            else if (cell !== "0" && cell !== "") td.classList.add('text-pos');
                        }
                        tr.appendChild(td);
                    });
                    pTable.appendChild(tr);
                });
            }
            
            // Invest Calc
            var iTable = document.getElementById('table-invest-calc');
            iTable.innerHTML = "";
            if (data.investCalcData && data.investCalcData.length > 0) {
                 data.investCalcData.forEach((row, rIdx) => {
                     var tr = document.createElement('tr');
                     row.forEach((cell, cIdx) => {
                         var el = (rIdx === 0) ? 'th' : 'td';
                         var td = document.createElement(el);
                         td.innerText = cell;
                         if (cIdx > 0 && rIdx > 0) td.className = "text-right";
                         tr.appendChild(td);
                     });
                     iTable.appendChild(tr);
                 });
            }
        }

        function triggerManualSync() {
            showToast("正在同步資料...");
            google.script.run.withSuccessHandler(function() {
                showToast("同步請求已發送");
                setTimeout(loadDashboard, 2000);
            }).handleManualSync({range: {getSheet: function(){return {getName: function(){return "損益試算"}}}, getA1Notation: function(){return "A27"}, getValue: function(){return true}, setValue: function(){}}}); 
        }

        function submitJournalPart(part) {
            var payload = { type: 'journal', date: document.getElementById('j_date_'+part).value };
            if (part === 'start') {
                payload.q3 = document.getElementById('j_q3').value;
                payload.q4 = document.getElementById('j_q4').value;
            } else if (part === 'middle') {
                payload.q5 = document.getElementById('j_q5').value;
                payload.q6 = document.getElementById('j_q6').value;
                payload.q7 = document.getElementById('j_q7').value;
                payload.career_review = document.getElementById('j_career_review').value;
            } else if (part === 'end') {
                payload.is_recording = document.getElementById('j_is_recording').checked ? "是" : "否";
                payload.q86 = document.getElementById('j_q86').checked ? "TRUE" : "FALSE";
                payload.q87 = document.getElementById('j_q87').checked ? "TRUE" : "FALSE";
                payload.q88 = document.getElementById('j_q88').checked ? "TRUE" : "FALSE";
                payload.q90 = document.getElementById('j_q90').checked ? "TRUE" : "FALSE";
                payload.health_status = document.getElementById('j_health_status').value;
                payload.declutter_item = document.getElementById('j_declutter_item').value;
                payload.note = document.getElementById('j_note').value;
                var mani = document.getElementById('j_manifestation').value; 
                if(mani) {
                     var parts = mani.split('|');
                     if(parts[0]) payload.q93 = parts[0].replace('感謝', '').trim();
                     if(parts[1]) payload.q94 = parts[1].replace('之前', '').trim();
                     if(parts[2]) payload.q95 = parts[2].replace('我感覺', '').trim();
                }
                payload.score = document.getElementById('j_score').value;
            }
            sendToQueue(payload, part);
        }
        
        function submitGratitude() {
            var txt = document.getElementById('journal-text').value;
            if(!txt) return;
            sendToQueue({ type: 'goal', text: txt }, 'gratitude');
            document.getElementById('journal-text').value = "";
        }

        function sendToQueue(data, modalId) {
            showToast("正在儲存...");
            fetch(FIREBASE_URL + "request_queue.json?auth=" + FIREBASE_SECRET, {
                method: 'POST', body: JSON.stringify(data)
            }).then(() => {
                showToast("儲存成功");
                if (modalId && modalId !== 'gratitude') closeJournalModal(modalId);
                setTimeout(loadDashboard, 1500);
            }).catch(e => showToast("儲存失敗: " + e));
        }

        // --- UI Interactions ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if(tabId==='tab-operation') document.getElementById('nav-operation').classList.add('active');
            if(tabId==='tab-dashboard') document.getElementById('nav-dashboard').classList.add('active');
            if(tabId==='tab-journal') document.getElementById('nav-journal').classList.add('active');
        }
        function openModal() { document.getElementById('expense-modal').classList.add('active'); }
        function closeModal() { document.getElementById('expense-modal').classList.remove('active'); }
        function openJournalModal(type) { document.getElementById('modal-'+type).classList.add('active'); }
        function closeJournalModal(type) { document.getElementById('modal-'+type).classList.remove('active'); }
        function showToast(msg) { var t = document.getElementById('toast'); t.innerText = msg; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 3000); }
        function selectMode(mode) { document.getElementById('op-selection').classList.add('hidden'); document.getElementById('form-'+mode).classList.remove('hidden'); }
        function backToSelection() { document.querySelectorAll('.operation-container').forEach(el => el.classList.add('hidden')); document.getElementById('op-selection').classList.remove('hidden'); }
        function toggleText(el) { el.classList.toggle('expanded'); }
        function updateReasonOptions() {
             var action = document.getElementById('s_action').value;
             var s = document.getElementById('s_reason');
             var label = document.getElementById('reasonLabel');
             s.innerHTML = "";
             if (action === "進場") {
                 label.style.color = "#d35400";
                 ["突破", "回檔", "支撐確認", "抄底"].forEach(o => s.add(new Option(o, o)));
             } else {
                 label.style.color = "#27ae60";
                 ["停利", "停損", "換股", "避險"].forEach(o => s.add(new Option(o, o)));
             }
        }
        function updateDayTradeReason() {
            var trend = document.getElementById('d_trend').value;
            var s = document.getElementById('d_reason');
            s.innerHTML = "";
            if (trend === "多") ["強勢股", "創高", "支撐有守"].forEach(o => s.add(new Option(o, o)));
            else ["弱勢股", "破底", "壓力不過"].forEach(o => s.add(new Option(o, o)));
        }
        function toggleSplitOptions() {
            var isSplit = document.getElementById('isSplit').checked;
            document.getElementById('split-section').style.display = isSplit ? 'block' : 'none';
        }
        function toggleSplitInputs() {
            var method = document.getElementById('splitMethod').value;
            document.getElementById('input-pan-part').style.display = (method === '潘部分') ? 'block' : 'none';
            document.getElementById('input-others').style.display = (method === '他人') ? 'block' : 'none';
            document.getElementById('input-chuan-pay').style.display = 'block';
        }
        function submitModalExpense() {
             var amt = document.getElementById('amount').value;
             if (!amt) return;
             var data = {
                 type: 'expense',
                 amount: amt,
                 paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value,
                 isSplit: document.getElementById('isSplit').checked ? "是" : "否",
                 splitMethod: document.getElementById('splitMethod').value,
                 panAmount: document.getElementById('panAmount').value,
                 othersAmount: document.getElementById('othersAmount').value,
                 chuanPay: document.getElementById('chuanPay').value,
                 isTobacco: document.getElementById('isTobacco').checked ? "是" : "否",
                 note: document.getElementById('note').value
             };
             sendToQueue(data, 'expense-modal');
        }
        function submitStock() {
            var d = {
                type: 'stock',
                date: document.getElementById('s_date').value,
                code: document.getElementById('s_code').value,
                name: document.getElementById('s_name').value,
                shares: document.getElementById('s_shares').value,
                price: document.getElementById('s_price').value,
                settlement: document.getElementById('s_settlement').value,
                trend: document.getElementById('s_trend').value,
                action: document.getElementById('s_action').value,
                reason: document.getElementById('s_reason').value,
                weekTrend: document.getElementById('s_weekTrend').value,
                dayTrend: document.getElementById('s_dayTrend').value,
                position: document.getElementById('s_position').value,
                volume: document.getElementById('s_volume').value,
                ma20t: document.getElementById('s_ma20t').value,
                maArrangement: document.getElementById('s_maArrangement').value,
                kd: document.getElementById('s_kd').value,
                macd: document.getElementById('s_macd').value,
                pressure: document.getElementById('s_pressure').value,
                support: document.getElementById('s_support').value
            };
            sendToQueue(d);
            showToast("波段紀錄已送出");
            backToSelection();
        }
        function submitDayTrade() {
            var d = {
                type: 'daytrade',
                date: document.getElementById('d_date').value,
                code: document.getElementById('d_code').value,
                name: document.getElementById('d_name').value,
                trend: document.getElementById('d_trend').value,
                reason: document.getElementById('d_reason').value,
                shares: document.getElementById('d_shares').value,
                entryPrice: document.getElementById('d_entryPrice').value,
                exitPrice: document.getElementById('d_exitPrice').value,
                exitReason: document.getElementById('d_exitReason').value
            };
            sendToQueue(d);
            showToast("當沖紀錄已送出");
            backToSelection();
        }
    </script>
</body>
</html>
